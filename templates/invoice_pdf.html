<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Invoice {{ invoice_no }}</title>
  <style>
    @page { size: A4 portrait; margin: 8mm; }
    html, body { width: 210mm; height: 297mm; }
    body { font-family: Arial, sans-serif; font-size: 10pt; color:#000; line-height:1.2; margin: 0; padding: 0; }

    .page { border: 1px solid #000; padding: 6mm; box-sizing: border-box; width: calc(100% - 2px); min-height: calc(297mm - 16mm); }

    .header { display: grid; grid-template-columns: 120px 1fr 120px; align-items: center; column-gap: 10px; margin-bottom: 4px; }
    .logo { height: 72px; object-fit: contain; }
    .gst { font-size: 9pt; text-align: center; margin-top: 2px; white-space: nowrap; }
    .brand h1 { margin: 0; font-size: 19pt; font-weight: 900; text-align: center; }
    .addr { font-size: 9.5pt; text-align: center; }
    .phone { font-size: 10.5pt; text-align: center; font-weight: 700; }

    table { width: 100%; border-collapse: collapse; table-layout: fixed; }
    th, td { border: 1px solid #000; padding: 4px 6px; vertical-align: top; font-size: 10pt; }
    th { background: #f5f5f5; font-weight: 700; }
    td, th { overflow-wrap: anywhere; }

    .items th:nth-child(1), .items td:nth-child(1) { width: 7%; text-align: center; }
    .items th:nth-child(2), .items td:nth-child(2) { width: 37%; }
    .items th:nth-child(3), .items td:nth-child(3) { width: 8%; }
    .items th:nth-child(4), .items td:nth-child(4) { width: 12%; text-align: center; white-space: nowrap; }
    .items th:nth-child(5), .items td:nth-child(5) { width: 8%; text-align: center; }
    .items th:nth-child(6), .items td:nth-child(6) { width: 14%; text-align: right; }
    .items th:nth-child(7), .items td:nth-child(7) { width: 14%; text-align: right; }

    .items-wrapper { height: 360px; overflow: hidden; margin-bottom: 4px; }
    .items td { height: 45px; padding: 3px 5px; font-size: 9.5pt; }

    .items tr.empty-row td { border-top: none; border-bottom: none; }
    .items tbody tr:last-of-type td { border-bottom: 1px solid #000 !important; }
    .items-end-line { border-top: 1px solid #000; margin-top: -1px; width: 100%; }

    .meta-wrap { display: grid; grid-template-columns: 1fr 1fr; column-gap: 10px; align-items: stretch; margin-top: 4px; }
    .meta-wrap table { height: 100%; }
    .meta-wrap td { font-size: 9.5pt; padding: 5px 6px; font-weight: normal; }
    .meta-wrap td label { font-weight: 600; }

    .parties-table { margin-top: 4px; margin-bottom: 4px; }
    .parties-table td { padding: 4px 6px; line-height: 1.3; }

    .totals-table { margin-top: 4px; margin-bottom: 4px; }
    .totals-table td { padding: 3px 6px; }

    .amount-section { margin-top: 4px; }
    .amount-section table { width: 100%; border-collapse: collapse; margin-top: 3px; }
    .amount-section td { border: 1px solid #000; padding: 4px 6px; }

    .bank-table { margin-top: 8px; }
    .bank-table td { padding: 8px 10px; }
    .bank-table pre { font-family: inherit; font-size: 9.5pt; margin: 2px 0 0 0; white-space: pre-wrap; line-height: 1.3; }

    .sign { height: 30px; margin: 6px 0; }
    .note-cell { padding: 10px 12px; font-size: 9pt; line-height: 1.3; }

    @media print { body { margin: 0; padding: 0; } .page { page-break-after: avoid; } }
  </style>
</head>
<body>
  <div class="page">
    <div class="header no-border">
      <div>
        {% if encoded_logo %}
          <img src="data:image/png;base64,{{ encoded_logo }}" alt="Select Media House" class="logo">
        {% else %}
          <div class="logo-placeholder">Logo</div>
        {% endif %}
        <div class="gst">GSTIN: {{ company.gstin }}</div>
      </div>
      <div class="brand">
        <h1>Select Media House</h1>
        <div class="addr">A-6, Sarla Bagh Extension, Dayal Bagh, Agra - 282005 (U.P.)</div>
        <div class="phone">Mob.: {{ company.phone }}</div>
      </div>
      <div class="center">
        <h2 style="margin:0; font-size: 14pt;">TAX INVOICE</h2>
      </div>
    </div>

    <div class="meta-wrap">
      <div>
        <table>
          <tr>
            <td><label>Invoice Number:</label> {{ invoice_no }}</td>
            <td><label>Invoice Date:</label> {{ invoice_date }}</td>
          </tr>
          <tr>
            <td><label>Buyer Order No:</label> {{ buyer_order_no }}</td>
            <td><label>Date of Supply:</label> {{ supply_date }}</td>
          </tr>
        </table>
      </div>
      <div>
        <table>
          <tr><td colspan="2"><label>Transporter Name:</label> {{ transporter_name }}</td></tr>
          <tr>
            <td style="white-space: nowrap;"><label>Vehicle No:</label> {{ vehicle_no }}</td>
            <td style="white-space: nowrap;"><label>GR / RR No:</label> {{ gr_no }}</td>
          </tr>
        </table>
      </div>
    </div>

    <table class="parties-table">
      <tr>
        <th class="center">Details of Receiver (Billed to)</th>
        <th class="center">Details of Consignee (Shipped to)</th>
      </tr>
      <tr>
        <td>
          <div><strong>Name:</strong> {{ billed_to.name }}</div>
          <div><strong>Address:</strong> {{ billed_to.address }}</div>
          <div><strong>State:</strong> {{ billed_to.state }} &nbsp; <strong>State Code:</strong> {{ billed_to.state_code }}</div>
          <div><strong>GSTIN No.:</strong> {{ billed_to.gstin }}</div>
        </td>
        <td>
          <div><strong>Name:</strong> {{ shipped_to.name }}</div>
          <div><strong>Address:</strong> {{ shipped_to.address }}</div>
          <div><strong>State:</strong> {{ shipped_to.state }} &nbsp; <strong>State Code:</strong> {{ shipped_to.state_code }}</div>
          <div><strong>GSTIN No.:</strong> {{ shipped_to.gstin }}</div>
        </td>
      </tr>
    </table>

    <div class="items-wrapper" style="margin-top:6px;">
      <table class="items">
        <thead>
          <tr>
            <th>S. No.</th>
            <th>DESCRIPTION OF GOODS</th>
            <th>HSN Code</th>
            <th>QUANTITY</th>
            <th>UOM</th>
            <th>RATE (Rs.)</th>
            <th>AMOUNT (Rs.)</th>
          </tr>
        </thead>
        <tbody>
          {% for it in items %}
          <tr class="{{ 'empty-row' if not it.description }}">
            <td class="center">{{ loop.index if it.description else '' }}</td>
            <td>{{ it.description }}</td>
            <td>{{ it.hsn }}</td>
            <td class="center">{{ it.qty if it.qty is not none else '' }}</td>
            <td class="center">{{ it.uom }}</td>
            <td class="right">{{ '%.2f'|format(it.rate) if it.rate is not none else '' }}</td>
            <td class="right">{{ '%.2f'|format(it.amount) if it.amount is not none else '' }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <div class="items-end-line"></div>

    <table class="totals-table">
      <tbody>
        <tr><td style="width:70%;"><strong>Discount</strong></td><td style="width:30%;" class="right">{{ '%.2f'|format(discount) }}</td></tr>
        <tr><td><strong>Total Value of Supply of Goods Before GST</strong></td><td class="right">{{ '%.2f'|format(subtotal) }}</td></tr>
        <tr><td><strong>CGST @ {{ '%.2f'|format(cgst_rate) }}%</strong></td><td class="right">{{ '%.2f'|format(cgst_amount) }}</td></tr>
        <tr><td><strong>SGST @ {{ '%.2f'|format(sgst_rate) }}%</strong></td><td class="right">{{ '%.2f'|format(sgst_amount) }}</td></tr>
        <tr><td><strong>IGST @ {{ '%.2f'|format(igst_rate) }}%</strong></td><td class="right">{{ '%.2f'|format(igst_amount) }}</td></tr>
        <tr><td><strong>Total Tax</strong></td><td class="right">{{ '%.2f'|format(total_tax) }}</td></tr>
        <tr><td><strong>Round off (+/-)</strong></td><td class="right">{{ '%.2f'|format(round_off) }}</td></tr>
        <tr><td><strong>Grand Total of Invoice</strong></td><td class="right"><strong>{{ '%.2f'|format(grand_total) }}</strong></td></tr>
      </tbody>
    </table>

    <div class="amount-section">
      <table>
        <tr>
          <td style="width:70%;"><strong>Invoice Total Value in words:</strong> {{ amount_in_words }}</td>
          <td style="width:30%;" class="right"><strong>Electronic Reference No.:</strong> {{ reference_no }}</td>
        </tr>
      </table>
    </div>

    <table class="bank-table" width="100%">
      <tr>
        <td style="width:60%;">
          <strong>BANK DETAILS</strong><br>
          <pre>{{ company.bank_details }}</pre>
        </td>
        <td style="width:40%; text-align:center;">
          <div>For <strong>Select Media House</strong></div>
          <div class="sign"></div>
          <div>Authorised Signatory</div>
        </td>
      </tr>
      <tr>
        <td colspan="2" class="note-cell" style="border-top: 1px solid black;">
          <strong>Note:</strong><br>
          1. All legal here will be bond for the assignment all issue will be settled AGRA Jurisdiction only.<br>
          2. If the payment is not made within days the interest @18% per annum will be charged extra.<br>
          3. All size & quality will be approximate slight variation may cause at the time of printing & finishing.
        </td>
      </tr>
    </table>
  </div>
</body>
</html>
